<% layout('layout') -%>
<!-- TODO Agregar validaciones a los campos, chequear cajas duplicadas o agregadas a otros grupos, permitir editar grupos -->

<div class="container-fluid" ng-app="Caller" ng-controller="callerController" >

  <div class="row">
    <h1>Caja <%= paydesk.number %></h1>
    <h3>Tipo de atencion: <%= paydesk.group.name %></h3>
  </div>


  <div class="row">
    <div class="col-md-6" id="current_client">
      <div class="row">
        <h4>Cliente en atencion</h4>
        <div class="row">
          <div class="col-md-4">
            <h5>Numero:</h5>
          </div>
          <div class="col-md-4" ng-bindl="current_client.number">

          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <h5>Horario de ingreso:</h5>
          </div>
          <div class="col-md-4" ng-bind="current_client.enqueue_time">

          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6" id="next_client">
      <div class="row">
        <h4>Cliente llamado</h4>
        <div class="row">
          <div class="col-md-4">
            <h5>Numero:</h5>
          </div>
          <div class="col-md-4" >
            <h5 ng-bind="called_client.number"></h5>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <h5>Horario de ingreso:</h5>
          </div>
          <div class="col-md-4"  >
          <h5 ng-bind="called_client.enqueue_time"></h5>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
      <a href="#"  class="btn btn-primary" ng-click="callNext()">Proximo</a>
  </div>

</div>

<script type='text/javascript' src='/javascripts/socket.io.js'></script>
<script>

  var socket = io('http://localhost:3232');

  socket.on('client_response', function (data) {
    console.log(data);
  });

  var app = angular.module('Caller', []);
  app.controller('callerController', function($scope,$http) {

      $scope.current_client = {};
      $scope.called_client = {};
      $scope.paydesk = {};

      $scope.load = function(paydesk_id) {
        $http.get("/paydesks/<%= paydesk._id %>").success(function(paydesk) {
          $scope.paydesk = paydesk;
        });
      }

      $scope.callNext = function() {
        $http.get("/paydesks/<%= paydesk._id %>/clients/next").success(function(next_client) {
          $scope.current_client = $scope.called_client;
          $scope.called_client = next_client;
        });
      }

  });

</script>


